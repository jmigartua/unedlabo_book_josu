
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>7 Modelling data is simpler using matrices &#8212; Applying Maths in the Chemical &amp; Biomolecular Sciences</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=ac02cc09edc035673794" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=ac02cc09edc035673794" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=ac02cc09edc035673794"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapter-13/analysis-C';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Questions 10 - 13" href="analysis-Q10-11.html" />
    <link rel="prev" title="Questions 4 - 9" href="analysis-Q4-9.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/book-cover.jpg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/book-cover.jpg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Applying Maths in the Chemical and Biomolecular Sciences.
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="analysis-intro.html">13. Data Analysis</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="analysis-A.html">1 Characterizing experimental data. Accuracy, precision, mean and standard deviation</a></li>
<li class="toctree-l2"><a class="reference internal" href="20240510_representacion_datos.html">Datos Práctica Electricidad I,</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysis-Q1-3.html">Questions 1 - 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysis-B.html">6 Modelling data. Least squares, chi squared, residuals, ANNOVA</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysis-Q4-9.html">Questions 4 - 9</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">7 Modelling data is simpler using matrices</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysis-Q10-11.html">Questions 10 - 13</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysis-D.html">10 Non-linear least squares. Least absolute deviation. Principal component analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysis-answers1-11.html">Solutions Q1 -11</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/subblue/applying-maths-book/main?urlpath=lab/tree/applying_maths_book/chapter-13/analysis-C.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/subblue/applying-maths-book/blob/main/applying_maths_book/chapter-13/analysis-C.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/subblue/applying-maths-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/subblue/applying-maths-book/issues/new?title=Issue%20on%20page%20%2Fchapter-13/analysis-C.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/chapter-13/analysis-C.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>7 Modelling data is simpler using matrices</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">7.1 Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#least-squares-fit-to-a-plane">7.2 Least squares fit to a plane</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#general-least-squares-method-for-a-polynomial">7.3 General least squares method for a polynomial</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-of-a-polynomial-fit">7.4 Example of a polynomial fit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion-of-results">7.5 Discussion of results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#confidence-limits">7.6 Confidence limits</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#photon-and-particle-counting-and-the-poisson-distribution">8 Photon and particle counting and the Poisson distribution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#i-counting-photons"><strong>(i) Counting photons</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ii-still-counting-photons"><strong>(ii) Still counting photons</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iii-ccd-detecting-photons"><strong>(iii) CCD detecting photons</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iv-dna-cleavage"><strong>(iv) DNA cleavage</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#v-chance-of-winning-a-lottery"><strong>(v) Chance of winning a lottery</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cumulative-distribution"><strong>Cumulative distribution</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#weighting-the-poisson-data"><strong>Weighting the Poisson data</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-signals-buried-in-noise">9 Estimating signals buried in noise</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="modelling-data-is-simpler-using-matrices">
<h1>7 Modelling data is simpler using matrices<a class="headerlink" href="#modelling-data-is-simpler-using-matrices" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import all python add-ons etc that will be needed later on</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">linalg</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">quad</span><span class="p">,</span><span class="n">odeint</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">t</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">f</span>
<span class="n">init_printing</span><span class="p">()</span>                      <span class="c1"># allows printing of SymPy results in typeset maths format</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">})</span>  <span class="c1"># set font size for plots</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># import all python add-ons etc that will be needed later on</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">&#39;matplotlib&#39;</span><span class="p">,</span> <span class="s1">&#39;inline&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="nn">File ~/anaconda3/envs/jupyterbooks/lib/python3.11/site-packages/IPython/core/interactiveshell.py:2432,</span> in <span class="ni">InteractiveShell.run_line_magic</span><span class="nt">(self, magic_name, line, _stack_depth)</span>
<span class="g g-Whitespace">   </span><span class="mi">2430</span>     <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;local_ns&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_local_scope</span><span class="p">(</span><span class="n">stack_depth</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2431</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">builtin_trap</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2432</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2434</span> <span class="c1"># The code below prevents the output from being displayed</span>
<span class="g g-Whitespace">   </span><span class="mi">2435</span> <span class="c1"># when using magics with decorator @output_can_be_silenced</span>
<span class="g g-Whitespace">   </span><span class="mi">2436</span> <span class="c1"># when the last Python token in the expression is a &#39;;&#39;.</span>
<span class="g g-Whitespace">   </span><span class="mi">2437</span> <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">magic</span><span class="o">.</span><span class="n">MAGIC_OUTPUT_CAN_BE_SILENCED</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>

<span class="nn">File ~/anaconda3/envs/jupyterbooks/lib/python3.11/site-packages/IPython/core/magics/pylab.py:99,</span> in <span class="ni">PylabMagics.matplotlib</span><span class="nt">(self, line)</span>
<span class="g g-Whitespace">     </span><span class="mi">97</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Available matplotlib backends: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">backends_list</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">98</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">99</span>     <span class="n">gui</span><span class="p">,</span> <span class="n">backend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">enable_matplotlib</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">gui</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">args</span><span class="o">.</span><span class="n">gui</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">100</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_show_matplotlib_backend</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">gui</span><span class="p">,</span> <span class="n">backend</span><span class="p">)</span>

<span class="nn">File ~/anaconda3/envs/jupyterbooks/lib/python3.11/site-packages/IPython/core/interactiveshell.py:3606,</span> in <span class="ni">InteractiveShell.enable_matplotlib</span><span class="nt">(self, gui)</span>
<span class="g g-Whitespace">   </span><span class="mi">3585</span> <span class="k">def</span> <span class="nf">enable_matplotlib</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gui</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">3586</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Enable interactive matplotlib and inline figure support.</span>
<span class="g g-Whitespace">   </span><span class="mi">3587</span><span class="sd"> </span>
<span class="g g-Whitespace">   </span><span class="mi">3588</span><span class="sd">     This takes the following steps:</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">   </span><span class="mi">3604</span><span class="sd">         display figures inline.</span>
<span class="g g-Whitespace">   </span><span class="mi">3605</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">-&gt; </span><span class="mi">3606</span>     <span class="kn">from</span> <span class="nn">matplotlib_inline.backend_inline</span> <span class="kn">import</span> <span class="n">configure_inline_support</span>
<span class="g g-Whitespace">   </span><span class="mi">3608</span>     <span class="kn">from</span> <span class="nn">IPython.core</span> <span class="kn">import</span> <span class="n">pylabtools</span> <span class="k">as</span> <span class="n">pt</span>
<span class="g g-Whitespace">   </span><span class="mi">3609</span>     <span class="n">gui</span><span class="p">,</span> <span class="n">backend</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">find_gui_and_backend</span><span class="p">(</span><span class="n">gui</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pylab_gui_select</span><span class="p">)</span>

<span class="n">File</span> <span class="o">~/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">jupyterbooks</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">matplotlib_inline</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">backend_inline</span><span class="p">,</span> <span class="n">config</span>  <span class="c1"># noqa</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.1.6&quot;</span>  <span class="c1"># noqa</span>

<span class="n">File</span> <span class="o">~/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">jupyterbooks</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">matplotlib_inline</span><span class="o">/</span><span class="n">backend_inline</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">6</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;A matplotlib backend for publishing figures via display_data&quot;&quot;&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="c1"># Copyright (c) IPython Development Team.</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="c1"># Distributed under the terms of the BSD 3-Clause License.</span>
<span class="ne">----&gt; </span><span class="mi">6</span> <span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colors</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="kn">from</span> <span class="nn">matplotlib.backends</span> <span class="kn">import</span> <span class="n">backend_agg</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;matplotlib&#39;
</pre></div>
</div>
</div>
</div>
<section id="introduction">
<h2>7.1 Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h2>
<p>While the equations for a linear equation are manageable as summations, the polynomial equations become impossibly complicated. However, as the main concern is not in the algebraic form of the equations <em>per se</em> , only in obtaining the solution to a problem, it is then simpler to convert the simultaneous normal equations into a matrix equation and to solve this for the constants.</p>
<p>Fitting with the equation <span class="math notranslate nohighlight">\(y = \alpha_0 + \alpha_1x\)</span> has already been described in some detail; the polynomial <span class="math notranslate nohighlight">\(y = \alpha_0 + \alpha_1x + \alpha_2x^2\)</span> and exponential <span class="math notranslate nohighlight">\(y = \alpha_0e^{-\alpha_1x}\)</span> are also commonly found functions that describe data. The polynomial still belongs to the class of linear least squares because the normal equations can be solved exactly. The exponential equation will need a non-linear least squares method because the normal equations cannot be solved exactly and an iterative method is required. The method of choice is often the gradient expansion method, also called the Levenberg-Marquardt method, and this is discussed in Section 8. First, however, a matrix formulation of the linear least squares problem is presented and a solution obtained for a polynomial.</p>
</section>
<section id="least-squares-fit-to-a-plane">
<h2>7.2 Least squares fit to a plane<a class="headerlink" href="#least-squares-fit-to-a-plane" title="Permalink to this heading">#</a></h2>
<p>In a molecule such as heam in hemoglobin it is important to know the distance of the oxygen and histidine N atom from the plane of the molecule and from the Fe atom as these may not be the same. For example the N-Fe atom distances may not change by much during reaction but the Fe itself may move relative to the plane of the molecule.</p>
<p>The equation of a plane is</p>
<div class="math notranslate nohighlight">
\[\displaystyle ax+by+c=z\]</div>
<p>where <span class="math notranslate nohighlight">\(a,b,c\)</span> are constants. Using the least squares method we minimise the sum of the squares of the deviations <em>via</em> the function</p>
<div class="math notranslate nohighlight">
\[\displaystyle S=\sum_i^n (ax_i+by_i+c-z_i)^2=0\]</div>
<p>for <span class="math notranslate nohighlight">\(n\)</span> sets of data points <span class="math notranslate nohighlight">\((x_i,y_i,z_i)\)</span> which means taking the derivatives with respect to <span class="math notranslate nohighlight">\(a,b,c\)</span>. Thus</p>
<div class="math notranslate nohighlight">
\[\begin{split}\displaystyle \frac{\partial S}{\partial a}=2\sum_i x_i(ax_i+by_i+c-z_i)=0,\\ \frac{\partial S}{\partial b}=2\sum_i y_i(ax_i+by_i+c-z_i)=0,\\ \frac{\partial S}{\partial c}=2\sum_i (ax_i+by_i+c-z_i)=0\end{split}\]</div>
<p>Using the notation as before <span class="math notranslate nohighlight">\(S_{xy} \equiv \sum_ix_iy_i\)</span> etc. and <span class="math notranslate nohighlight">\(S_1=\sum_i 1=n\)</span> for <span class="math notranslate nohighlight">\(n\)</span> data points. There are three  equations to solve in three unknowns;</p>
<div class="math notranslate nohighlight">
\[\begin{split}\displaystyle \qquad\qquad\begin{align}&amp;aS_{x^2}+bS_{xy}+cS_x=S_{xz}\\ &amp;aS_{xy}+bS_{y^2}+cS_y=S_{yz}\\ &amp;aS_x+bS_y+cS_1=S_z\end{align}\qquad\qquad\qquad\qquad\text{(42a)}\end{split}\]</div>
<p>The simplest way to solve these using a computer is to convert to a matrix equation <span class="math notranslate nohighlight">\(\boldsymbol {AC}=\boldsymbol B \)</span> and solve this. The equations become</p>
<div class="math notranslate nohighlight">
\[\begin{split}\displaystyle \qquad\qquad\boldsymbol {AC}=\boldsymbol B\quad  \text{ or }\quad \begin{bmatrix}S_{x^2}&amp; S_{xy} &amp; S_x\\ S_{xy}&amp; S_{y^2}&amp; S_y    \\ S_x&amp; S_y&amp; n \end{bmatrix} \begin{bmatrix}a\\b\\c \end{bmatrix}= \begin{bmatrix}S_{xz}\\ S_{yz}\\S_z \end{bmatrix} \qquad\qquad\qquad\qquad\text{(42b)}\end{split}\]</div>
<p>and as the coefficients we want <span class="math notranslate nohighlight">\((a,b,c)\)</span> are in column matrix <span class="math notranslate nohighlight">\(C\)</span>, the calculation  <span class="math notranslate nohighlight">\(\boldsymbol C = \boldsymbol {A}^{-1}\boldsymbol B\)</span> gives these values.</p>
<p>The Fe atom is placed at (0,0,0) only because this is easier for plotting.  The equation of the plane is <span class="math notranslate nohighlight">\(z=0.64x+0.56y+0.42z\)</span> and is shown in figure 10a.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Algorithm: example fit to plane of heam Data pdb 1THB.</span>

<span class="c1"># put Fe atom at x,y,z = 0 </span>

<span class="n">Fe</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">6.591</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.663</span><span class="p">,</span>  <span class="mf">12.091</span><span class="p">])</span>          <span class="c1"># HETATM .... HEM C 1 1THB3507</span>
<span class="n">HisN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">7.742</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.655</span><span class="p">,</span>  <span class="mf">10.429</span><span class="p">])</span> <span class="o">-</span> <span class="n">Fe</span><span class="p">[:]</span>  <span class="c1"># Atom ... HIS 87 NE2 1THB3086</span>
<span class="n">NA</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">7.559</span><span class="p">,</span> <span class="o">-</span><span class="mf">18.441</span><span class="p">,</span>  <span class="mf">12.096</span><span class="p">])</span> <span class="o">-</span> <span class="n">Fe</span><span class="p">[:]</span>
<span class="n">NB</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">7.832</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.106</span><span class="p">,</span>  <span class="mf">13.651</span><span class="p">])</span> <span class="o">-</span> <span class="n">Fe</span><span class="p">[:]</span>
<span class="n">NC</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">5.405</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.044</span><span class="p">,</span>  <span class="mf">12.620</span><span class="p">])</span> <span class="o">-</span> <span class="n">Fe</span><span class="p">[:]</span>
<span class="n">ND</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">5.015</span><span class="p">,</span> <span class="o">-</span><span class="mf">17.506</span><span class="p">,</span>  <span class="mf">11.076</span><span class="p">])</span> <span class="o">-</span> <span class="n">Fe</span><span class="p">[:]</span>
<span class="n">Ox1</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">5.558</span><span class="p">,</span> <span class="o">-</span><span class="mf">17.474</span><span class="p">,</span>  <span class="mf">13.668</span><span class="p">])</span> <span class="o">-</span> <span class="n">Fe</span><span class="p">[:]</span>
<span class="n">Ox2</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">4.756</span><span class="p">,</span> <span class="o">-</span><span class="mf">17.191</span><span class="p">,</span>  <span class="mf">14.691</span><span class="p">])</span> <span class="o">-</span> <span class="n">Fe</span><span class="p">[:]</span> 
<span class="n">Fe</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">NA</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">NB</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">NC</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ND</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>           <span class="c1"># rearrange into x, y, z</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">NA</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">NB</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">NC</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ND</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">NA</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">NB</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">NC</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">ND</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>

<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>                                        <span class="c1"># n = sum(1) over all 4 atoms</span>
<span class="n">sxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>                                <span class="c1"># make all summations</span>
<span class="n">syy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">sxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">)</span>
<span class="n">sx</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sy</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">sxz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="p">)</span>
<span class="n">syz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y</span><span class="o">*</span><span class="n">z</span><span class="p">)</span>
<span class="n">sz</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">sxx</span><span class="p">,</span><span class="n">sxy</span><span class="p">,</span><span class="n">sx</span><span class="p">],[</span><span class="n">sxy</span><span class="p">,</span><span class="n">syy</span><span class="p">,</span><span class="n">sy</span><span class="p">],[</span><span class="n">sx</span><span class="p">,</span><span class="n">sy</span><span class="p">,</span><span class="n">n</span><span class="p">]])</span> <span class="c1"># A matrix of S values.</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">sxz</span><span class="p">,</span><span class="n">syz</span><span class="p">,</span><span class="n">sz</span><span class="p">])</span> 

<span class="n">fit</span> <span class="o">=</span> <span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">@</span> <span class="n">b</span><span class="o">.</span><span class="n">T</span>                         <span class="c1"># @ is matrix multiply </span>
                                                  <span class="c1"># b is a row matrix so transpose with .T</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}{:8.4g}{:s}{:8.4g}{:s}{:8.4g}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;a = &#39;</span><span class="p">,</span> <span class="n">fit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;, b = &#39;</span><span class="p">,</span><span class="n">fit</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;, c = &#39;</span><span class="p">,</span><span class="n">fit</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>a =   0.6358, b =    0.557, c =   0.4196
</pre></div>
</div>
</div>
</div>
<p><img alt="Drawing" src="../_images/analysis-fig10a.png" /></p>
<p>Figure 10a. The Fe atom is moved to be at zero in coordinates and other atoms moved accordingly. The fit is to the plane of the four N atoms and is the black rectangle shown almost edge on. The four N atoms in heam (blue) lie mostly in this plane. The data is used in Question 52 ‘Vectors’ and from pdb 1THB. The Fe atom can be seen to be just out of the plane of the four nitrogen atoms. The two oxygens (red) and the N atom in histidine (green) are also shown. THe sizes of the atoms does not represent their actual or relative radii and was chosen for clarity.</p>
</section>
<hr class="docutils" />
<section id="general-least-squares-method-for-a-polynomial">
<h2>7.3 General least squares method for a polynomial<a class="headerlink" href="#general-least-squares-method-for-a-polynomial" title="Permalink to this heading">#</a></h2>
<p>A general way of describing a fitting equation is</p>
<div class="math notranslate nohighlight">
\[\displaystyle Y=\sum_{i=1}^m \alpha_if_i(x) \qquad\tag{43}\]</div>
<p>which means that that the model equation proposed to represent the data is the sum of m functions, <span class="math notranslate nohighlight">\(f_i(x)\)</span>, multiplied by constants <span class="math notranslate nohighlight">\(\alpha_i\)</span> whose values we seek, much as was done in a Fourier series. If the equation is a polynomial, then <span class="math notranslate nohighlight">\(f_1(x) = 1,\; f_2(x) = x,\; f_3(x) = x^2\)</span>, and so forth, and, if an exponential then <span class="math notranslate nohighlight">\(f_1(x) = e^{-\alpha_2x},\; f_2(x) = e^{-\alpha_4x}\)</span>, etc. It is clear why these last two equations are non-linear because the constants are intimate to the function itself and cannot be separated from it.</p>
<p>The sum of the deviations is minimized just as in the case of the straight line, the equation is</p>
<div class="math notranslate nohighlight">
\[\displaystyle S=\sum_kw_k\left(y_k-\sum_i^m\alpha_if_i(x_k)\right)^2\]</div>
<p>and the subscript on <span class="math notranslate nohighlight">\(x\)</span> is <span class="math notranslate nohighlight">\(k\)</span> because this is the <span class="math notranslate nohighlight">\(k^{th}\; x\)</span> value in the data and <span class="math notranslate nohighlight">\(k\)</span> has values <span class="math notranslate nohighlight">\(1\cdots n\)</span>. The subscript <span class="math notranslate nohighlight">\(i=1\cdots m\)</span> identifies the terms in the expansion of the model function of equation 43. Differentiating the <span class="math notranslate nohighlight">\(j^{th}\)</span> term in the <span class="math notranslate nohighlight">\(i^{th}\)</span> summation (<span class="math notranslate nohighlight">\(j\)</span> being anywhere in the list <span class="math notranslate nohighlight">\(i=1\cdots m\)</span>), to obtain the minimum, produces</p>
<div class="math notranslate nohighlight">
\[\displaystyle \frac{\partial S}{\partial \alpha_j}=-2\sum_k w_kf_j(x_k)\left(y_k-\sum_i^m\alpha_if_i(x_k)\right)=0\qquad\tag{44}\]</div>
<p>and the <span class="math notranslate nohighlight">\(f(x)\)</span> remains inside the summation because it depends on the <span class="math notranslate nohighlight">\(x_k\)</span>. Rearranging the terms in this equation gives a (complicated) set of simultaneous equations, because <span class="math notranslate nohighlight">\(j\)</span> can take any value in the range <span class="math notranslate nohighlight">\(1 \to m\)</span> for in the function expansion.</p>
<div class="math notranslate nohighlight">
\[\displaystyle \sum_k w_k f_j(x_k)y_k = \sum_k\left( w_kf_j(x_k)\sum_i\alpha_if_i(x_k) \right)\qquad\tag{45}\]</div>
<p>the right-hand side of which is a sum of a sum. For example, the third term is</p>
<div class="math notranslate nohighlight">
\[\begin{split}\displaystyle \qquad\qquad\begin{align}\sum_kw_ky_kf_3(x_k)=&amp;\sum_k\sum_iw_kf_3(x_k)\alpha_if_i(x_k)\\ =&amp;\sum_k w_kf_3(x_k)\left(\alpha_if_i(x_k) +\alpha_2f_2(x_k)+\cdots + \alpha_mf_m(x_k)\;\right)\end{align}\qquad\qquad\text{(46)}\end{split}\]</div>
<p>and all <span class="math notranslate nohighlight">\(m\)</span> of these equations can be solved to find the m constants, the <span class="math notranslate nohighlight">\(\alpha\)</span>’s, if the function is linear. A matrix method can be used to do this, but to convert the simultaneous equations into a matrix equation needs a little cunning. A matrix equation of the form</p>
<div class="math notranslate nohighlight">
\[\displaystyle \boldsymbol B=\boldsymbol{CA} \qquad\tag{47}\]</div>
<p>can be made where <span class="math notranslate nohighlight">\(\boldsymbol C\)</span> contains the coefficients. The left-hand side of this equation is a row matrix with a sum over the <span class="math notranslate nohighlight">\(k\)</span> data points for each of <span class="math notranslate nohighlight">\(m\)</span> terms and is the left-hand side of equation 45,</p>
<div class="math notranslate nohighlight">
\[\begin{split}\displaystyle \begin{align}\boldsymbol B=&amp;\begin{bmatrix} \sum_kw_ky_kf_1(x_k) &amp; \sum_kw_ky_kf_1(x_k) &amp;\cdots\end{bmatrix}\\
\equiv&amp;\begin{bmatrix} S(wyf_1) &amp; S(wyf_2)&amp; \cdots\end{bmatrix}\end{align}\end{split}\]</div>
<p>and, in the second line, the abbreviation, <span class="math notranslate nohighlight">\(S(\cdots )\)</span>, is used to indicate the summation over the <span class="math notranslate nohighlight">\(k\)</span> data points. The right-hand side of the normal equations (13.45) can be written as a square matrix A left multiplied by a row matrix C to make another row matrix thus making the right-hand side of the equation equal to the left. To form <span class="math notranslate nohighlight">\(\boldsymbol{CA}\)</span>, the right-hand side of 45 or 46 has to be split into a column and square matrix. It is clear that in each term <span class="math notranslate nohighlight">\(f\)</span> has indices in <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(k\)</span> so the term in row 1 column 2 in the <span class="math notranslate nohighlight">\(A\)</span> matrix can be written using the <span class="math notranslate nohighlight">\(S\)</span> abbreviation as <span class="math notranslate nohighlight">\(\displaystyle S(wf_1f_2)\equiv \sum_kw_kf_1(x_k)f_2(x_k)\)</span> and does not contain any <span class="math notranslate nohighlight">\(\alpha\)</span>, therefore</p>
<div class="math notranslate nohighlight">
\[\begin{split}\displaystyle \boldsymbol A=\begin{bmatrix} S(wf_1f_2)&amp; S(wf_1f_2) &amp; S(wf_1f_3)&amp;\cdots\\ S(wf_2f_1)&amp; S(wf_2f_2) &amp; S(wf_2f_3)&amp;\cdots\\ &amp;\vdots&amp; &amp;\ddots \end{bmatrix}\end{split}\]</div>
<p>If the row matrix C contains only the coefficients, <span class="math notranslate nohighlight">\(\displaystyle \boldsymbol C=\begin{bmatrix} \alpha_1 &amp; \alpha_2 &amp; \cdots\end{bmatrix}\)</span> the right-hand side of matrix equation 47 is</p>
<div class="math notranslate nohighlight">
\[\begin{split}\displaystyle \boldsymbol{CA} = \begin{bmatrix} \alpha_1 &amp; \alpha_2 &amp; \cdots\end{bmatrix} \begin{bmatrix} S(wf_1f_2)&amp; S(wf_1f_2) &amp; S(wf_1f_3)&amp;\cdots\\ S(wf_2f_1)&amp; S(wf_2f_2) &amp; S(wf_2f_3)&amp;\cdots\\ &amp;\vdots&amp; &amp;\ddots \end{bmatrix}\end{split}\]</div>
<p>Expanding out the third term produces</p>
<div class="math notranslate nohighlight">
\[\displaystyle \alpha_1S(wf_1f_3)+\alpha_2S(wf_2f_3)+\alpha_3S(wf_3f_3)+\cdots +\alpha_mS(wf_mf_3)\]</div>
<p>which is the same as equation 46.</p>
<p>The aim is to find the values in the <span class="math notranslate nohighlight">\(C\)</span> matrix and this can be achieved by the transformation</p>
<div class="math notranslate nohighlight">
\[\displaystyle \boldsymbol B=CA \to \boldsymbol{BA}^{-1} = \boldsymbol{CAA}^{-1} \to \boldsymbol C=\boldsymbol{BA}^{-1} \qquad\tag{48}\]</div>
<p>Thus the inverse of <span class="math notranslate nohighlight">\(\boldsymbol A\)</span> is all that is needed to find the coefficients, furthermore this inverse is also the matrix of the variances and co-variances (Bevington 1969).</p>
</section>
<section id="example-of-a-polynomial-fit">
<h2>7.4 Example of a polynomial fit<a class="headerlink" href="#example-of-a-polynomial-fit" title="Permalink to this heading">#</a></h2>
<p>As an example, the functional dependence of the vibrational energy levels of the <span class="math notranslate nohighlight">\(B (^3\sum _u^-)\)</span> excited state of the oxygen molecule, which has <span class="math notranslate nohighlight">\(D_{\infty h}\)</span> point group symmetry, will be found by analysing some data. The <span class="math notranslate nohighlight">\((^3\sum_u^-)\)</span> term symbol means that the molecule is in a triplet spin state and hence has two unpaired electrons, one in each of two orbitals, which together have zero orbital angular momentum, hence the symbol <span class="math notranslate nohighlight">\(\sigma\)</span>. The orbitals are ungerade (<span class="math notranslate nohighlight">\(u\)</span>) or odd, so that they do not have a centre of inversion and the minus sign means that the electronic state is symmetric to <span class="math notranslate nohighlight">\(C_2\; (180^\text{o})\)</span> rotation about the principal axis. The vibrational levels have been measured by observing the absorption spectrum in the ultraviolet starting just above <span class="math notranslate nohighlight">\(200\)</span> nm and the <span class="math notranslate nohighlight">\(n=0\)</span> level has energy of <span class="math notranslate nohighlight">\(49363\;\mathrm{cm^{-1}}\)</span> above the <span class="math notranslate nohighlight">\(n=0\)</span> of the ground state. The energies of the vibrational levels above the bottom of this potential well and their quantum numbers <span class="math notranslate nohighlight">\(n\)</span>, are shown in the table.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\displaystyle \begin{array}{ccccc}\\
\hline
G/\mathrm{cm^{-1}} &amp;352.3 &amp; 1039 &amp; 1705 &amp; 2340 &amp; 2961 &amp; 3553 &amp; 4113 &amp; 4652 \\
n&amp; 0 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 &amp;7\\
\hline
G/\mathrm{cm^{-1}}&amp; 5153 &amp; 5613 &amp; 6040 &amp; 6433 &amp; 6780 &amp; 7083 &amp; 7335\\
n&amp; 8 &amp; 9 &amp; 10 &amp; 11 &amp; 12 &amp; 13 &amp; 14\\
\hline \end{array}\end{split}\]</div>
<p>The weights for the data are unknown and hence <span class="math notranslate nohighlight">\(1\)</span> is used, as this produces an unbiased estimate of the coefficients. An anharmonic potential energy model will be tested. The Morse potential produces vibrational energies (in cm<span class="math notranslate nohighlight">\(^{-1}\)</span>);</p>
<div class="math notranslate nohighlight">
\[\displaystyle G_2=v_e(n+1/2)-x_ev_e(n+1/2)^2\]</div>
<p>and if this is not sufficient to describe the data, it is common to add another term empirical term</p>
<div class="math notranslate nohighlight">
\[\displaystyle G_2=v_e(n+1/2)-x_ev_e(n+1/2)^2+y_ev_e(n+1/2)^3\]</div>
<p>or</p>
<div class="math notranslate nohighlight">
\[\displaystyle G_3=\left(\frac{1}{2}-\frac{x_e}{4}+\frac{y_e}{8} \right)v_e+ \left(1-x_e+\frac{3y_e}{4}\right)v_en+\left(\frac{3y_e}{2}-x_e\right)v_en^2+y_ev_en^3\qquad\tag{49}\]</div>
<p>which is a cubic polynomial in <span class="math notranslate nohighlight">\(n\)</span>. The equilibrium frequency is <span class="math notranslate nohighlight">\(v_e\;\mathrm{ (cm^{-1})}\)</span> and the anharmonicity terms are <span class="math notranslate nohighlight">\(x_e\)</span> and <span class="math notranslate nohighlight">\(y_e\)</span>. In the Morse potential, <span class="math notranslate nohighlight">\(x_e = v_e/4D_e\)</span> where <span class="math notranslate nohighlight">\(D_e\)</span> is the dissociation energy in cm<span class="math notranslate nohighlight">\(^{-1}\)</span>, but <span class="math notranslate nohighlight">\(y_e\)</span> is empirical and the aim is to determine <span class="math notranslate nohighlight">\(x_e, y_e\)</span> and <span class="math notranslate nohighlight">\(v_e\)</span>. If the quantum number <span class="math notranslate nohighlight">\(n\)</span> is represented by <span class="math notranslate nohighlight">\(x\)</span>, and the constants by <span class="math notranslate nohighlight">\(c\)</span>, then the Morse model <span class="math notranslate nohighlight">\(G_2\)</span> is equivalent to a function <span class="math notranslate nohighlight">\(f=c_0 +c_1x+c_2x^2\)</span>  and the second model <span class="math notranslate nohighlight">\(f=c_0 +c_1x+c_2x^2 +c_3x^3\)</span>. The least squares model calculates these coefficients and these can then be related to the spectroscopic parameters <span class="math notranslate nohighlight">\(v_e, x_e\)</span> and <span class="math notranslate nohighlight">\(y_e\)</span>. The residuals and <span class="math notranslate nohighlight">\(\chi^2\)</span> will be used to test the fit to the data. (Note that different authors us different symbols to represent frequency, and this can be in units of cm<span class="math notranslate nohighlight">\(^{-1}\)</span>, s<span class="math notranslate nohighlight">\(^{-1}\)</span>, rad cm<span class="math notranslate nohighlight">\(^{-1}\)</span> or rad s<span class="math notranslate nohighlight">\(^{-1}\)</span>).</p>
<p>The Python implementation is quite simple, compared to the derivation, and even compared to the linear case.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Algorithm: Least Squares  polynomial fit</span>

<span class="n">yval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">352.3</span><span class="p">,</span><span class="mi">1039</span><span class="p">,</span><span class="mi">1705</span><span class="p">,</span><span class="mi">2340</span><span class="p">,</span><span class="mi">2961</span><span class="p">,</span><span class="mi">3553</span><span class="p">,</span><span class="mi">4113</span><span class="p">,</span><span class="mi">4652</span><span class="p">,</span><span class="mi">5153</span><span class="p">,</span><span class="mi">5613</span><span class="p">,</span><span class="mi">6040</span><span class="p">,</span><span class="mi">6433</span><span class="p">,</span><span class="mi">6780</span><span class="p">,</span><span class="mi">7083</span><span class="p">,</span><span class="mi">7335</span><span class="p">])</span>
<span class="n">n</span>    <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">yval</span><span class="p">)</span>
<span class="n">xval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span>
<span class="n">w</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span>  <span class="c1"># weights unknown so use 1</span>

<span class="n">m</span> <span class="o">=</span> <span class="mi">4</span>                                   <span class="c1"># 4 params; C[0] + C[1]*x + C[2]*x**2 + C[3]*x**3 </span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">m</span><span class="p">,</span><span class="n">m</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">yval</span><span class="o">*</span><span class="n">xval</span><span class="o">**</span><span class="n">i</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">xval</span><span class="o">**</span><span class="n">i</span><span class="o">*</span><span class="n">xval</span><span class="o">**</span><span class="n">j</span><span class="p">)</span>
    <span class="k">pass</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;least squares values &#39;</span><span class="p">,</span><span class="n">C</span><span class="p">)</span>

<span class="n">line</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="p">)</span>    <span class="c1"># fit C[0] + C[1]*x + C[2]*x**2 + C[3]*x**3 </span>
<span class="n">chisqr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">yval</span><span class="o">-</span><span class="n">line</span><span class="p">(</span><span class="n">xval</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># reduced chi sqr</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1"> </span><span class="si">{:6.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;chi^2 = &#39;</span><span class="p">,</span><span class="n">chisqr</span><span class="p">)</span> <span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">m</span>                                             <span class="c1"># using chi squared function directly</span>
<span class="n">fchi</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">df</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">df</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">gamma</span><span class="p">(</span><span class="n">df</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
<span class="n">Q</span><span class="p">,</span><span class="n">err</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">fchi</span> <span class="p">,</span><span class="n">chisqr</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1"> </span><span class="si">{:6.3f}</span><span class="s1"> </span><span class="si">{:s}</span><span class="s1"> </span><span class="si">{:6.3g}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;probability of getting chi^2 &gt; &#39;</span><span class="p">,</span><span class="n">chisqr</span><span class="p">,</span><span class="s1">&#39; is&#39;</span><span class="p">,</span> <span class="n">Q</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>least squares values  [ 3.54563954e+02  6.91757746e+02 -8.54753465e+00 -3.74147394e-01]
chi^2 =   8.917
probability of getting chi^2 &gt;   8.917  is   0.63
</pre></div>
</div>
</div>
</div>
<p><img alt="Drawing" src="../_images/analysis-fig11.png" /></p>
<p>Figure 11. Experimental data points and the function <span class="math notranslate nohighlight">\(G_3\)</span> calculated by least squares. The residuals are shown on the top of the plot. Notice how small the residual scale is compared to that of the data.</p>
<hr class="docutils" />
<p>The error matrix is calculated as the inverse of <span class="math notranslate nohighlight">\(\boldsymbol A\)</span>. The off-diagonal terms are the covariances, notice that the matrix is symmetric about the diagonal. The covariances between <span class="math notranslate nohighlight">\(c_1\)</span> and <span class="math notranslate nohighlight">\(c_2\)</span> are quite large, <span class="math notranslate nohighlight">\(-0.34\)</span>, and these are expected to be the least accurate since one value may compensate for the other; the other covariances values are small.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>      <span class="c1"># invert matrix</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>          <span class="c1"># pretty print matrix</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:6.3f}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cov</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="p">),</span> <span class="n">end</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span>        <span class="c1"># end=&#39;&#39; prevents line return </span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">coefficients and errors&#39;</span><span class="p">)</span>    
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:8.4g}</span><span class="s1"> </span><span class="si">{:s}</span><span class="s1"> </span><span class="si">{:6.1g}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="s1">&#39; +/- &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cov</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">])</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 0.673 -0.344  0.047 -0.002 
-0.344  0.276 -0.045  0.002 
 0.047 -0.045  0.008 -0.000 
-0.002  0.002 -0.000  0.000 

coefficients and errors
   354.6  +/-     0.8
   691.8  +/-     0.5
  -8.548  +/-    0.09
 -0.3741  +/-   0.004
</pre></div>
</div>
</div>
</div>
</section>
<section id="discussion-of-results">
<h2>7.5 Discussion of results<a class="headerlink" href="#discussion-of-results" title="Permalink to this heading">#</a></h2>
<p>To calculate the spectroscopic parameters, the constants have to be compared to the expansion of the <span class="math notranslate nohighlight">\(G_3\)</span> equation 49, which is</p>
<div class="math notranslate nohighlight">
\[\displaystyle G_3=\left(\frac{1}{2}-\frac{x_e}{4}+\frac{y_e}{8} \right)v_e+ \left(1-x_e+\frac{3y_e}{4}\right)v_en+\left(\frac{3y_e}{2}-x_e\right)v_en^2+y_ev_en^3\qquad\tag{49}\]</div>
<p>The first term in this equation corresponds to <span class="math notranslate nohighlight">\(c_1\)</span> and is the zero point energy. The constants are</p>
<div class="math notranslate nohighlight">
\[\displaystyle v_ey_e = -0.3741,\; v_ex_e = 7.98,\; v_e = 692\;\mathrm{ cm^{-1}}\]</div>
<p>which compare well with the values given by Herzberg (1950, p. 559) which are</p>
<div class="math notranslate nohighlight">
\[\displaystyle v_ey_e = -0.3753,\; v_ex_e = 8.00,\; v_e = 700.36\;\mathrm{ cm^{-1}}\]</div>
<p>and the zero point energy is <span class="math notranslate nohighlight">\(348.13\)</span> cm<span class="math notranslate nohighlight">\(^{-1}\)</span>. Because the weighting is unknown, the <span class="math notranslate nohighlight">\(\chi^2\)</span> is only relative but the <span class="math notranslate nohighlight">\(Q\)</span> factor is large <span class="math notranslate nohighlight">\(0.63\)</span> meaning that there is a <span class="math notranslate nohighlight">\(63\)</span>% by chance of getting a lager value even for a correct model, i.e. at random we expect to see this <span class="math notranslate nohighlight">\(\chi^2\)</span> being exceeded which indicates that the model fits the data, because perfect fit would produce a probability of <span class="math notranslate nohighlight">\(50\)</span>% in this test. If the chance <span class="math notranslate nohighlight">\(Q\)</span> were very small and effectively zero the <span class="math notranslate nohighlight">\(\chi^2\)</span> could never be exceeded at random which would indicate a poor fit, i.e the <span class="math notranslate nohighlight">\(\chi^2\)</span> is so large that a larger value cannot be reached by random chance. This means that the <span class="math notranslate nohighlight">\(\chi^2\)</span> is far out in the wings of the distribution. A good fit is obvious from the residuals as well.</p>
<p>The calculation with the Morse equation <span class="math notranslate nohighlight">\(G_2\)</span> is achieved by setting <span class="math notranslate nohighlight">\(m = 3\)</span> and making no other changes. The calculation produces a fit that looks virtually the same as shown in figure 12, but the residuals are about ten times larger and oscillate noticeably. The <span class="math notranslate nohighlight">\(\chi^2 = 737\)</span> and <span class="math notranslate nohighlight">\(Q \approx 10^{-150}\to 0\)</span> and this <span class="math notranslate nohighlight">\(\chi^2\)</span> is so big that it there is no chance of it being exceeded at random, which means that the chance that this model is correct is effectively zero. This demonstrates that <span class="math notranslate nohighlight">\(\chi^2\)</span> and the residuals are vital in determining the correct fit. If five terms are used in the calculation, the <span class="math notranslate nohighlight">\(\chi^2\)</span> is reduced only to <span class="math notranslate nohighlight">\(8.6\)</span>, compared to <span class="math notranslate nohighlight">\(8.9\)</span> for four terms, which is essentially the same value, therefore, five terms are rejected as not providing any significant improvement in fitting the data, i.e. the fifth term is unnecessary. Finally, if the fifth term is added a physical reason for doing this must be advanced and justified by the dynamics of the molecule.</p>
<p><img alt="Drawing" src="../_images/analysis-fig12.png" /></p>
<p>Figure 12. Data, fit and residuals for the <span class="math notranslate nohighlight">\(G_2\)</span> fitting equation showing oscillations because this model function does not describe the data well. Compare with fig 11.</p>
</section>
<hr class="docutils" />
<section id="confidence-limits">
<h2>7.6 Confidence limits<a class="headerlink" href="#confidence-limits" title="Permalink to this heading">#</a></h2>
<p>The confidence limits can be calculated in a similar manner to that for the straight line, using the value from the <span class="math notranslate nohighlight">\(t\)</span> distribution. The equations look slightly different because the matrix method is used. (See Hines &amp; Montgomery 1990, Chapters 14-15 for the details.) They calculate the mean square error <span class="math notranslate nohighlight">\(SSE /(n - m - 1)\)</span>, which is the same as the <span class="math notranslate nohighlight">\(\chi^2\)</span> on the whole data set, and give the formula which is equivalent to the one used here, where matrices <span class="math notranslate nohighlight">\(\boldsymbol{C}\)</span> and <span class="math notranslate nohighlight">\(\displaystyle{B}\)</span> are defined as in equations 47-48,</p>
<div class="math notranslate nohighlight">
\[\displaystyle \chi^2=\frac{\sum_i y_i- \boldsymbol{C\cdot B}}{n-m-1}\qquad\tag{50}\]</div>
<p>The confidence limits at <span class="math notranslate nohighlight">\(95\)</span>% are now</p>
<div class="math notranslate nohighlight">
\[\displaystyle c_i\pm t_{0.025,n-m-1}\sqrt{\chi^2}\sqrt{ \boldsymbol A^{-1}_{ii}} \]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol A^{-1}_{ii}\)</span> is the <span class="math notranslate nohighlight">\(i^{th}\)</span> diagonal value of the inverted A matrix and <span class="math notranslate nohighlight">\(c_i\)</span> is the <span class="math notranslate nohighlight">\(i^{th}\)</span> coefficient.</p>
<p>If the row matrix <span class="math notranslate nohighlight">\(x_0 = \begin{bmatrix}1&amp; x&amp; x^2&amp; x^3\end{bmatrix}\)</span> is defined, limited to <span class="math notranslate nohighlight">\(x^3\)</span>, because the highest power of <span class="math notranslate nohighlight">\(x\)</span> used in the model function is <span class="math notranslate nohighlight">\(x^3\)</span>, then the <span class="math notranslate nohighlight">\(95\)</span>% confidence lines around the fitted curve (line(x)) are calculated as</p>
<div class="math notranslate nohighlight">
\[\displaystyle line(x)= \pm t_{0.025,n-m-1}\sqrt{\chi^2}\sqrt{ \boldsymbol{x}_0\boldsymbol A^{-1}\boldsymbol{x}_0^T} \]</div>
<p>This curve is not shown in figure 11 because it is almost identical to the fitted curve, and would not be clear on the graph. Note that the product of the three matrices is a function of <span class="math notranslate nohighlight">\(x\)</span> because matrix A consists only of numbers. See figure 7.7 (Matrices) for examples of matrix multiplication.</p>
</section>
<section id="photon-and-particle-counting-and-the-poisson-distribution">
<h2>8 Photon and particle counting and the Poisson distribution<a class="headerlink" href="#photon-and-particle-counting-and-the-poisson-distribution" title="Permalink to this heading">#</a></h2>
<p>The Poisson distribution is formed by accumulating many events, <span class="math notranslate nohighlight">\(n\)</span>, and describes the situation where each event has a very small probability of occurring, <span class="math notranslate nohighlight">\(p\)</span>, but the product <span class="math notranslate nohighlight">\(np\)</span>, the mean number of events, is moderate. The distribution is asymmetric and skewed towards small numbers, Figure 13, because it is not possible to have a negative number of events. This distribution is observed when photons are counted or particles counted after a radioactive atom disintegrates, provided their decay time is long compared to the observation time. However, the distribution applies to many other types of events, such as the number of faulty CDs produced, the number of misprints on a printed page, or the number of students absent from a class in any week. One of the earliest examples was recorded over a twenty year period during the 1800’s, and was the number of deaths of infantrymen in the Prussian army after they were kicked by a horse.</p>
<p>Suppose that a sample of molecules is continuously excited, and their fluorescence viewed through a small aperture or through filters to reduce the intensity so that photons are detected one at a time by a photodiode or photomultiplier. The number of electrical pulses from the detector for, say, <span class="math notranslate nohighlight">\(1000\)</span> time intervals each of <span class="math notranslate nohighlight">\(1\)</span> second duration is recorded. If a histogram of the number of events recorded in each time interval is made, then this should follow a Poisson distribution. If DNA is exposed to UV light, photo-damage can occur by base pairs forming dimers. If the DNA is spliced into pieces of equal length, the number of dimers in each piece can be recorded. If the pieces are each very small, 10 base pairs for example, most will not contain a dimer, a few will contain one and fewer still will contain two or more and so on. The distribution formed will have a large value for zero dimers and become smaller as the number of dimers increases. In a second experiment, suppose that <span class="math notranslate nohighlight">\(100\)</span> base pair long segments are examined. Now only a few segments have no dimer, some have one and many have two, three, or four but fewer segments will have five or more. This distribution is now peaked at a value of, say, <span class="math notranslate nohighlight">\(2.5\)</span>. Repeating the experiment with a larger segment will cause the distribution to peak at still larger values until it closely resembles a normal distribution. What has changed between the experiments is only the average number of dimers detected in each segment, thus the Poisson distribution is determined by only one parameter, the average number of ‘events’. A similar argument applies to the number of photons or particles detected in progressively longer time intervals.</p>
<p>The Poisson distribution applies when the number of events <span class="math notranslate nohighlight">\(n\)</span> that are measured is very large, but the chance <span class="math notranslate nohighlight">\(p\)</span> of any one event occurring is very small. The product <span class="math notranslate nohighlight">\(\mu = np\)</span> is the mean or average number of events and is of moderate value. The distribution can be derived from first principles, see Hines &amp; Montgomery (1990, chapter 6.8) for this proof, or it can be obtained from the binomial distribution when <span class="math notranslate nohighlight">\(n\)</span> is large and <span class="math notranslate nohighlight">\(p\)</span> small.</p>
<p>A Poisson process is that one that generates the distribution and assumes that each event randomly occurring is independent of all others and that each occurs in a non-overlapping time interval (i.e. its own). This means that in a time interval <span class="math notranslate nohighlight">\(\delta t\)</span> (a) the chance of only one event being recorded is <span class="math notranslate nohighlight">\(\lambda \delta t\)</span> where <span class="math notranslate nohighlight">\(\lambda\)</span> is a positive number, (b) The probability that zero events happen is then <span class="math notranslate nohighlight">\(1-\lambda\delta t\)</span> and (c) the probability that two or more events is zero. The constant <span class="math notranslate nohighlight">\(\lambda\)</span> is called the mean arrival rate and has units of 1/time.</p>
<p>The chance of no event occurring at time <span class="math notranslate nohighlight">\(t\to t+\delta t\)</span> (where <span class="math notranslate nohighlight">\(t\)</span> is fixed) is</p>
<div class="math notranslate nohighlight">
\[\displaystyle p_0(t+\delta t)=(1-\lambda)\delta tp_0(t)\]</div>
<p>which is the product of the chance of no events up to time <span class="math notranslate nohighlight">\(t\)</span> and of no events in time <span class="math notranslate nohighlight">\(t\to\delta t\)</span>. Rearranged this is</p>
<div class="math notranslate nohighlight">
\[\displaystyle \frac{p_0(t+\delta t)-p_0(t)}{\delta t}=-\lambda p_0(t)\]</div>
<p>and in the limit of small time increment is the simple differential equation; <span class="math notranslate nohighlight">\(\displaystyle \frac{dp_0(t)}{dt}=-\lambda p_0(t)\)</span>.</p>
<p>Integrating and multiplying by the number of molecules <span class="math notranslate nohighlight">\(N_0\)</span>, initially present that can react, fluoresce or decay radioactively give the familiar first order decay, <span class="math notranslate nohighlight">\(N=N_0e^{-\lambda t}\)</span> where <span class="math notranslate nohighlight">\(\lambda\)</span> is the rate constant for the process and its reciprocal the lifetime.</p>
<p>When the number of events is not zero, the chance of <span class="math notranslate nohighlight">\(k\)</span> events in the same time interval is</p>
<div class="math notranslate nohighlight">
\[\displaystyle p_k(t+\delta t)= \lambda \delta t p_{k-1}(t) + (1-\lambda)\delta tp_k(t)\]</div>
<p>The first term on the right is the chance of <span class="math notranslate nohighlight">\(k-1\)</span> events in up to time <span class="math notranslate nohighlight">\(t\)</span> then one event in time <span class="math notranslate nohighlight">\(\delta t\)</span>, the second the chance of all <span class="math notranslate nohighlight">\(k\)</span> events in time <span class="math notranslate nohighlight">\(t\)</span> and none in <span class="math notranslate nohighlight">\(\delta t\)</span>.</p>
<p>Rearranging and taking the limit <span class="math notranslate nohighlight">\(\delta t \to 0\)</span> produces a second differential equation</p>
<div class="math notranslate nohighlight">
\[\displaystyle \frac{dp_k(t)}{dt}=-\lambda p_k(t)+\lambda p_{k-1}(t)\]</div>
<p>The two equations can be solved with</p>
<div class="math notranslate nohighlight">
\[\displaystyle p_k(t)=\frac{(\lambda t)^ke^{-\lambda t}} {k!},\qquad k=0,1,2\cdots\qquad\tag{50a}\]</div>
<p>At a given time <span class="math notranslate nohighlight">\(t\)</span> we let <span class="math notranslate nohighlight">\(\mu=\lambda t\)</span> and then The Poisson Distribution equation becomes</p>
<div class="math notranslate nohighlight">
\[\displaystyle p(k,\mu)=\frac{\mu^ke^{-\mu}}{k!} \qquad\tag{50b}\]</div>
<p>also called the Poisson frequency distribution or ‘density’ function. The integer number of events is <span class="math notranslate nohighlight">\(k\)</span> and the mean value of the distribution is <span class="math notranslate nohighlight">\(\mu\)</span> which is dimensionless and which is not an integer. The shape of the distribution is shown in Figure 13 for different mean values <span class="math notranslate nohighlight">\(\mu\)</span>. The plots show continuous values for <span class="math notranslate nohighlight">\(k\)</span> although the distribution is only valid for integer values.</p>
<p>Notice that, when the mean is larger, the distribution resembles a normal distribution and is almost symmetrical. But at small <span class="math notranslate nohighlight">\(\mu\)</span>, the distribution is very asymmetrical with the mean always to larger <span class="math notranslate nohighlight">\(k\)</span> than the peak (the mode or most probable value) of the distribution. The standard deviation of the distribution is also shown and this is</p>
<div class="math notranslate nohighlight">
\[\displaystyle \sigma=\sqrt{\mu}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mu\)</span> is the average number of events detected; for instance, the number of photons detected in a given time period at a given wavelength. This is important as it means that <span class="math notranslate nohighlight">\(\sigma\)</span> is always known for any number of counts. This relationship also means that the weighting for analysing Poisson distributed data is for each point <span class="math notranslate nohighlight">\(i\)</span>, <span class="math notranslate nohighlight">\(w_i = 1/k_i\)</span>. The mean <span class="math notranslate nohighlight">\(\mu\)</span> and variance <span class="math notranslate nohighlight">\(\langle k^2\rangle\)</span> are</p>
<div class="math notranslate nohighlight">
\[\displaystyle  \mu\equiv\langle k\rangle =\sum_{k=0}^n k\,p(k,\mu),\qquad \langle k^2\rangle=\sum_{k=0}^n k^2 p(k,\mu)\]</div>
<p>and so as per definition <span class="math notranslate nohighlight">\(\sigma^2=\langle k^2\rangle-\langle k\rangle^2 \)</span> and both <span class="math notranslate nohighlight">\(\langle k\rangle\)</span> and the variance are equal to <span class="math notranslate nohighlight">\(\mu\)</span>, see Q10.</p>
<p>The chance of no success, that is of not observing an ‘event’, is <span class="math notranslate nohighlight">\(e^{-\mu}\)</span>. The chance of observing one event <span class="math notranslate nohighlight">\(k = 1\)</span> is <span class="math notranslate nohighlight">\(\mu e^{-\mu}\)</span>, of two events <span class="math notranslate nohighlight">\(\mu^2e^{-\mu}/2!\)</span>, and of exactly <span class="math notranslate nohighlight">\(k\)</span> events is <span class="math notranslate nohighlight">\(p(k, \mu)\)</span>. The chance of observing more than one event is <span class="math notranslate nohighlight">\(1 - e^{-\mu}\)</span>. The sum to infinity is unity, and therefore the distribution is normalized.</p>
<p><img alt="Drawing" src="../_images/analysis-fig13.png" /></p>
<p>Figure 13 The Poisson distribution for different integer <span class="math notranslate nohighlight">\(k\)</span> values and various means values <span class="math notranslate nohighlight">\(\mu\)</span>. Although <span class="math notranslate nohighlight">\(k\)</span> is an integer, the lines are drawn as if it were continuous. The standard deviation <span class="math notranslate nohighlight">\(\sigma = \sqrt{\mu}\)</span>, is shown for <span class="math notranslate nohighlight">\(\mu = 2\)</span> and <span class="math notranslate nohighlight">\(12\)</span>. The distribution becomes more Normal as <span class="math notranslate nohighlight">\(\mu\)</span> increases.</p>
<hr class="docutils" />
<section id="i-counting-photons">
<h3><strong>(i) Counting photons</strong><a class="headerlink" href="#i-counting-photons" title="Permalink to this heading">#</a></h3>
<p>A photomultiplier records photons at a constant rate of <span class="math notranslate nohighlight">\(\lambda =0.4\)</span> events per <span class="math notranslate nohighlight">\(100\)</span> nanoseconds.</p>
<p><span class="math notranslate nohighlight">\(\quad\)</span> (a) What is the chance that no event is recorded in the first <span class="math notranslate nohighlight">\(200\)</span> ns and</p>
<p><span class="math notranslate nohighlight">\(\quad\)</span> (b) what is the chance that no photon occurs in the next <span class="math notranslate nohighlight">\(100\)</span> ns if none are recorded in the first two?</p>
<p><strong>Solution</strong>. The parameter <span class="math notranslate nohighlight">\(\mu =\lambda t =0.4\cdot 2\)</span> taking the time unit as <span class="math notranslate nohighlight">\(100\)</span> ns and <span class="math notranslate nohighlight">\(k=0\)</span> for no event so <span class="math notranslate nohighlight">\( p(k,\mu) = e^{-0.8} = 0.45 \)</span>. In (b) because the events are independent so probability of an event between time slot <span class="math notranslate nohighlight">\(2\to 3\)</span> is the same as that of <span class="math notranslate nohighlight">\(0\to 1\)</span>, thus <span class="math notranslate nohighlight">\(p(k,\mu)= e^{-0.4}=0.67\)</span>.</p>
</section>
<section id="ii-still-counting-photons">
<h3><strong>(ii) Still counting photons</strong><a class="headerlink" href="#ii-still-counting-photons" title="Permalink to this heading">#</a></h3>
<p>Counting photons with a more fluorescent sample photons are recorded at a rate of <span class="math notranslate nohighlight">\(4\)</span> per <span class="math notranslate nohighlight">\(100\)</span> ns. What is the chance that</p>
<p><span class="math notranslate nohighlight">\(\quad\)</span> (a) one has been detected in <span class="math notranslate nohighlight">\(50\)</span> ns and</p>
<p><span class="math notranslate nohighlight">\(\quad\)</span> (b) a total of <span class="math notranslate nohighlight">\(5\)</span> in <span class="math notranslate nohighlight">\(250\)</span> ns?</p>
<p><strong>Solution</strong>. Again taking the time unit as <span class="math notranslate nohighlight">\(100\)</span> ns <span class="math notranslate nohighlight">\(\mu=4\cdot 0.5\)</span> for the first photon (<span class="math notranslate nohighlight">\(k=1\)</span>) giving <span class="math notranslate nohighlight">\(p(k,\mu)=\mu e^{-\mu} = 2e^{-2} = 0.27\)</span>. (b) The probability of the total event is the product of the two, where each event is independent, there is one photon in the first period and <span class="math notranslate nohighlight">\(4\)</span> more in the extra period. For the extra period, <span class="math notranslate nohighlight">\(\mu=4\cdot 2\)</span> and the probability with <span class="math notranslate nohighlight">\(k=4\)</span> is <span class="math notranslate nohighlight">\(p(k,\mu)=8^4e^{-8}/4!=0.057\)</span> and combined is <span class="math notranslate nohighlight">\(0.0155\)</span>.</p>
</section>
<section id="iii-ccd-detecting-photons">
<h3><strong>(iii) CCD detecting photons</strong><a class="headerlink" href="#iii-ccd-detecting-photons" title="Permalink to this heading">#</a></h3>
<p>There is a <span class="math notranslate nohighlight">\(2\)</span>% chance of a CCD detecting a photon / angstrom in the range 3500 to 3600 angstrom.</p>
<p><span class="math notranslate nohighlight">\(\quad\)</span> What is the chance that at least two photons will be detected?</p>
<p><strong>Solution</strong>. As two or more are detected we find the chance of not detecting zero or one photons, which is <span class="math notranslate nohighlight">\(1-p(0,\mu)-p(1,\mu)\)</span> and as <span class="math notranslate nohighlight">\(\mu= 0.02\cdot 100 = 2 \)</span> the chance is <span class="math notranslate nohighlight">\(1- 2^0e^{-2}/0!-2^1e^{-2}/1= 0.59\)</span>. As no time period is specified this period could take any value without changing the answer excepting that the probability would then be <span class="math notranslate nohighlight">\(0.59\)</span>/time period.</p>
</section>
<section id="iv-dna-cleavage">
<h3><strong>(iv) DNA cleavage</strong><a class="headerlink" href="#iv-dna-cleavage" title="Permalink to this heading">#</a></h3>
<p>Poisson distributions arise in surprising situations. DNA can be cleaved in various ways, for example by special enzymes or in a simpler way by exciting with light a dye intercalated between base pairs or directly by ultra-violet light.</p>
<p><span class="math notranslate nohighlight">\(\quad\)</span>If a piece of DNA containing <span class="math notranslate nohighlight">\(n = 12000\)</span> base pairs and with equal GCAT content is to be cleaved by an enzyme that recognises the sequence GGCGCC, what is the chance that there is failure to cleave?</p>
<p><strong>Solution</strong>. As there are six bases to be recognised but only four types of bases in DNA (G,C,A,T) the chance of matching the sequence is <span class="math notranslate nohighlight">\(p=1/4^6=1/4096\)</span> with average of <span class="math notranslate nohighlight">\(\mu = np =12000/4096=2.93\)</span>. Using the Poisson distribution the chance of no cleavage (<span class="math notranslate nohighlight">\(k=0\)</span>) is <span class="math notranslate nohighlight">\(P(0,\mu)=\mu^0e^{-\mu}/0!= 0.053\)</span> or <span class="math notranslate nohighlight">\(5.3\)</span>% which means that <span class="math notranslate nohighlight">\(\approx 95\)</span>% are cleaved. In this calculation it is implicitly assumed that all small groups of sequences are equally likely, which is probably not an unreasonable assumption in a long piece of DNA.</p>
<p>We can check the calculation by calculating the average number of target sequences expected and this should be greater than zero if it is to be cleaved. If we start at one end of the DNA and go through and look for a G then there are on average <span class="math notranslate nohighlight">\(12000/4=3000\)</span> of them, next look for GG then the number is <span class="math notranslate nohighlight">\(3000/4= 750\)</span>, and if we continue in this way we get GGC with <span class="math notranslate nohighlight">\(750/4\)</span>, GGCG with <span class="math notranslate nohighlight">\(750/16\)</span>, GGCGC with <span class="math notranslate nohighlight">\(750/64\)</span> and GGCGCC with <span class="math notranslate nohighlight">\(750/256 \approx 3\)</span> and this is <span class="math notranslate nohighlight">\(n/4^6\)</span> which means that on average we expect cleavage to happen.</p>
</section>
<section id="v-chance-of-winning-a-lottery">
<h3><strong>(v) Chance of winning a lottery</strong><a class="headerlink" href="#v-chance-of-winning-a-lottery" title="Permalink to this heading">#</a></h3>
<p>In a lottery every player has to guess a sequence of <span class="math notranslate nohighlight">\(6\)</span> digits from <span class="math notranslate nohighlight">\(0\to 9\)</span>. If a million people play, what is the probability that there are two winners?</p>
<p><strong>Solution</strong>. Each player has a one in a million chance of guessing the right number and each player guesses independently. The number of winners is then a Poisson random variable with <span class="math notranslate nohighlight">\(\mu=10^6\cdot 10^{-6}=1\)</span>. The chance is <span class="math notranslate nohighlight">\(p(2,1)= 1^2e^{-1}/2!\approx 0.18\)</span>.</p>
</section>
<section id="cumulative-distribution">
<h3><strong>Cumulative distribution</strong><a class="headerlink" href="#cumulative-distribution" title="Permalink to this heading">#</a></h3>
<p>The cumulative distribution is found by summing to a given <span class="math notranslate nohighlight">\(k\)</span> value</p>
<div class="math notranslate nohighlight">
\[\displaystyle CDF=\sum_{k=0}^np(k,\mu)=e^{-\mu}\left(1+\mu +\frac{\mu^2}{2!}+\frac{\mu^3}{3!}+\cdots +\frac{\mu^n}{n!}\right)\]</div>
<p>The cumulative distribution is used to estimate the chance of having a value larger than say the 95% probability.</p>
</section>
<section id="weighting-the-poisson-data">
<h3><strong>Weighting the Poisson data</strong><a class="headerlink" href="#weighting-the-poisson-data" title="Permalink to this heading">#</a></h3>
<p>Photon and particle counting experiments normally follow a Poisson distribution. The weighting to use is <span class="math notranslate nohighlight">\(w_i = 1/c_i\)</span> where <span class="math notranslate nohighlight">\(c_i\)</span> is the mean number of counts at the <span class="math notranslate nohighlight">\(i^{th}\)</span> data point in the data, thus, the weighting is always known. This does lead to a specific problem, viz., what happens when no counts are recorded in a particular channel, <span class="math notranslate nohighlight">\(c_i = 0\)</span>? This is quite possible at low light levels as occurs in single photon counting fluorescence decay experiments, or, when measuring fluorescence from single molecules through a confocal microscope. The advice to deal with this is to manipulate the data either by ignoring values below <span class="math notranslate nohighlight">\(10\)</span> counts, or to add <span class="math notranslate nohighlight">\(1\)</span> to every data point or to make each zero into <span class="math notranslate nohighlight">\(1\)</span> and leave all the rest alone. None of this is satisfactory because it will cause incorrect parameters to be produced to the fitted data, and must be avoided. By making these changes, both the data and residuals are changed similarly so the effect can be disguised. The solution (Turton et al. Anal. Chem. 2003) is to fit the data with a weighting of <span class="math notranslate nohighlight">\(1\)</span> and then the use values from the fitted curve as the weighting and refit the data. This has been shown to produce unbiased fits down to a very few counts in the total signal and contradicts the widespread assumption that least squares fitting of Poisson distributed data is invalid. One further point worth making is that when conducting counting experiments, it is not the maximum number of counts in any one channel that is important for data fitting but the total number of counts in the whole signal.</p>
</section>
</section>
<section id="estimating-signals-buried-in-noise">
<h2>9 Estimating signals buried in noise<a class="headerlink" href="#estimating-signals-buried-in-noise" title="Permalink to this heading">#</a></h2>
<p>A useful feature of Poisson distributed data is that their sum is also Poisson distributed. If <span class="math notranslate nohighlight">\(x_1, x_2, x_3 \cdots\)</span> are a set of Poisson distributed random numbers with means <span class="math notranslate nohighlight">\(\mu_1, \mu_2\cdots\)</span>, then their sum <span class="math notranslate nohighlight">\(\mu = \mu_1 + \mu_2 + \mu_2 + \cdots\)</span> is also Poisson distributed with mean <span class="math notranslate nohighlight">\(\mu\)</span> and standard deviation <span class="math notranslate nohighlight">\(\sqrt{\mu}\)</span>. Thus, data can be summed to improve its standard deviation. However, Poisson distributed data cannot be subtracted, because it would be quite possible to obtain negative numbers. This means that when a signal that is Poisson distributed has some background noise, this cannot be subtracted away but the model used to analyse the data has to contain a constant term to account for this, if the background is known to be constant, or a polynomial if it is not.</p>
<p>All instruments produce noise unrelated to the signal and it is often necessary to decide if a signal is present in noise but summing (binning) data does not help because the noise is also summed. For example, a very weak light source may be obscured by thermally induced ‘dark’ noise from the detector (photomultiplier, photodiode, or CCD etc.) and subsequently amplified in other circuitry. Alternatively, the noise could be from other light close in wavelength to the one being detected or electrical noise added by amplifiers. To decide if a signal is present, data has to be taken with and without what is suspected to be the true signal being there.</p>
<p>Distinguishing between signal and noise depends crucially only on their respective standard deviations. A large and constant background is not a problem; it is the <em>fluctuation</em> in the background that limits the signal to noise. To illustrate this, an argument presented by Parratt (1971, Chapter 5.8) based on the combination of errors equation, is described. If there are two sets of counts, <span class="math notranslate nohighlight">\(c_b\)</span> for the background and <span class="math notranslate nohighlight">\(c_{sb}\)</span> for signal and background, because a signal cannot be detected without background, then the difference in the population <em>means</em> is</p>
<div class="math notranslate nohighlight">
\[\displaystyle \mu_s-\mu_{sb}=c_b-c_{sb}\pm \Delta s\]</div>
<p>where <span class="math notranslate nohighlight">\(\Delta s\)</span> is the experimental standard deviation of the difference in counts. If there are many measurements, the central limit theorem predicts that this difference is normally distributed. Then, using the combination (propagation) of errors equation,</p>
<div class="math notranslate nohighlight">
\[\displaystyle \Delta s=\sqrt{2\left(s_b^2+s_{sb}^2\right)}\]</div>
<p>where <span class="math notranslate nohighlight">\(s_b\)</span> and <span class="math notranslate nohighlight">\(s_{sb}\)</span> are the standard deviations for background and signal plus background respectively. For single measurements of Poisson data the standard deviation is equal to the number of counts giving <span class="math notranslate nohighlight">\(\Delta s=\sqrt{2\left(c_b^2+c_{sb}^2\right)}\)</span>. If the two means <span class="math notranslate nohighlight">\(\mu_b\)</span> and <span class="math notranslate nohighlight">\(\mu_{sb}\)</span> are for the moment assumed to be the same then <span class="math notranslate nohighlight">\(c_b - c_{sb}\)</span> can be tested by comparing with <span class="math notranslate nohighlight">\(\Delta s\)</span> at, say, the <span class="math notranslate nohighlight">\(5\)</span>% probability level of a standard normal distribution to determine the chance whether or not <span class="math notranslate nohighlight">\(c_b = c_{sb}\)</span>. If the ratio <span class="math notranslate nohighlight">\(| c_b - c_{sb} |/\Delta s = 1\)</span>, then the probability that <span class="math notranslate nohighlight">\(c_b \ne c_{sb} = 0.32\)</span>, (or <span class="math notranslate nohighlight">\(32\)</span>%) which is the area of the normal curve <em>above</em> <span class="math notranslate nohighlight">\(x/\sigma = 1\)</span>, Figure 4 and this is too small to be considered very strong proof that the signal and noise are different. If the ratio <span class="math notranslate nohighlight">\(| c_b - c_{sb} |/\Delta s \ge 1.96\)</span> then chance that <span class="math notranslate nohighlight">\(c_b \ne c_{sb}\)</span> is measured at the <span class="math notranslate nohighlight">\(95\)</span> % level (see Table 1) and the signal would be distinguishable from background.</p>
<p>Consider the case when the counts at a given wavelength in a spectrum are <span class="math notranslate nohighlight">\(c_{sb} = 105\)</span> and <span class="math notranslate nohighlight">\(c_b =100\)</span> , then <span class="math notranslate nohighlight">\(\Delta s=14.3\)</span> and <span class="math notranslate nohighlight">\(c_b -c_{sb} =5\)</span> and the ratio <span class="math notranslate nohighlight">\(| c_b - c_{sb} |/\Delta s = 0.35\)</span>. Using the cumulative distribution described in equation 9, the chance that <span class="math notranslate nohighlight">\(c_b \ne c_{sb}\)</span> is <span class="math notranslate nohighlight">\(\approx 27\)</span>%. Note that to use the two sided values the integration is multiplied by 2 and subtracting one makes it the chance <span class="math notranslate nohighlight">\(c_b \ne c_{sb}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cb</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">csb</span><span class="o">=</span> <span class="mi">105</span>
<span class="n">deltas</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">cb</span><span class="o">+</span><span class="n">csb</span><span class="p">))</span>
<span class="n">ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cb</span><span class="o">-</span><span class="n">csb</span><span class="p">)</span><span class="o">/</span><span class="n">deltas</span>
<span class="n">fnorm</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>  <span class="c1"># normal distribution mu=0,sigma=1</span>
<span class="n">ans</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">fnorm</span><span class="p">,</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span><span class="n">ratio</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1"> </span><span class="si">{:6.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">% c</span><span class="s1">hance different&#39;</span><span class="p">,</span><span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ans</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>% chance different   27.3
</pre></div>
</div>
</div>
</div>
<p>which is so sufficiently that the two signals are indistinguishable. If the counts are <span class="math notranslate nohighlight">\(c_{sb} = 150\)</span> and <span class="math notranslate nohighlight">\(c_b = 100\)</span> then <span class="math notranslate nohighlight">\(\Delta_s = 15.8\)</span> and <span class="math notranslate nohighlight">\(c_{sb} - c_b = 50\)</span> and percentage chance that <span class="math notranslate nohighlight">\(c_b \ne c_{sb}\)</span>  is</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cb</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">csb</span><span class="o">=</span> <span class="mi">150</span>
<span class="n">deltas</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">cb</span><span class="o">+</span><span class="n">csb</span><span class="p">))</span>
<span class="n">ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cb</span><span class="o">-</span><span class="n">csb</span><span class="p">)</span><span class="o">/</span><span class="n">deltas</span>
<span class="n">fnorm</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">ans</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">fnorm</span><span class="p">,</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span><span class="n">ratio</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1"> </span><span class="si">{:6.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">% c</span><span class="s1">hance different&#39;</span><span class="p">,</span><span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ans</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>% chance different   99.8
</pre></div>
</div>
</div>
</div>
<p>Therefore, the signals can easily be distinguished above the noise at the <span class="math notranslate nohighlight">\(99.8\)</span>% confidence level, which means that the chance that the difference in means will exceed the standard deviation by pure chance alone is only <span class="math notranslate nohighlight">\(0.16\)</span> %.</p>
<p>If the data is not Poisson distributed and/or data sets are added together, then</p>
<div class="math notranslate nohighlight">
\[\displaystyle \Delta s=\sqrt{\frac{s_b^2}{n_b}+\frac{s_{sb}^2}{n_{sb}}}\]</div>
<p>for <span class="math notranslate nohighlight">\(n_{sb}\)</span> sets of signal measurements and <span class="math notranslate nohighlight">\(n_b\)</span> background.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapter-13"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="analysis-Q4-9.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Questions 4 - 9</p>
      </div>
    </a>
    <a class="right-next"
       href="analysis-Q10-11.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Questions 10 - 13</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">7.1 Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#least-squares-fit-to-a-plane">7.2 Least squares fit to a plane</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#general-least-squares-method-for-a-polynomial">7.3 General least squares method for a polynomial</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-of-a-polynomial-fit">7.4 Example of a polynomial fit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion-of-results">7.5 Discussion of results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#confidence-limits">7.6 Confidence limits</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#photon-and-particle-counting-and-the-poisson-distribution">8 Photon and particle counting and the Poisson distribution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#i-counting-photons"><strong>(i) Counting photons</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ii-still-counting-photons"><strong>(ii) Still counting photons</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iii-ccd-detecting-photons"><strong>(iii) CCD detecting photons</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iv-dna-cleavage"><strong>(iv) DNA cleavage</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#v-chance-of-winning-a-lottery"><strong>(v) Chance of winning a lottery</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cumulative-distribution"><strong>Cumulative distribution</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#weighting-the-poisson-data"><strong>Weighting the Poisson data</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-signals-buried-in-noise">9 Estimating signals buried in noise</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Godfrey Beddard
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=ac02cc09edc035673794"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>